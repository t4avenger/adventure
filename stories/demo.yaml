start: "camp"

nodes:
  camp:
    text: "You wake at the edge of a quiet camp. The woods watch you."
    scenery: "clearing"
    choices:
      - key: "north"
        text: "Head north into the trees"
        next: "forest"
      - key: "train"
        text: "Practice your skills (+1 Strength, +1 Luck, clamped 1-12)"
        effects:
          - op: "add"
            stat: "strength"
            value: 1
          - op: "add"
            stat: "luck"
            value: 1
        next: "camp"
      - key: "rest"
        text: "Rest a moment (+1 Health, max 12)"
        effects:
          - op: "add"
            stat: "health"
            value: 1
            clampMax: 12
        next: "camp"

  forest:
    text: "The forest is cold and still. A shadow moves."
    scenery: "forest"
    choices:
      - key: "sneak"
        text: "Try to sneak past (2d6 <= Luck)"
        check:
          stat: "luck"
          roll: "2d6"
          target: "stat"   # compare roll <= stat value
        onSuccessNext: "clearing"
        onFailureNext: "ambush"
      - key: "charge"
        text: "Charge through (2d6 <= Strength)"
        check:
          stat: "strength"
          roll: "2d6"
          target: "stat"
        onSuccessNext: "clearing"
        onFailureNext: "ambush"
      - key: "road"
        text: "Take the road towards the hills"
        next: "road"

  clearing:
    text: "You reach a moonlit clearing. For now, you're safe. (END)"
    scenery: "clearing"
    ending: true

  ambush:
    text: "A creature lunges from the dark! You take 2 damage. (END)"
    scenery: "forest"
    effects:
      - op: "add"
        stat: "health"
        value: -2
    ending: true

  road:
    text: "On the road, a goblin blocks your path, snarling as it draws a rusty blade."
    scenery: "road"
    choices:
      - key: "fight"
        text: "Attack the goblin (Strength + 2d6)"
        mode: "battle_attack"
        battle:
          enemyName: "Goblin"
          enemyStrength: 8
          enemyHealth: 3
          onVictoryNext: "goblin_victory"
          onDefeatNext: "goblin_defeat"
      - key: "luck"
        text: "Press your luck for a stronger blow"
        mode: "battle_luck"
        battle:
          enemyName: "Goblin"
          enemyStrength: 8
          enemyHealth: 3
          onVictoryNext: "goblin_victory"
          onDefeatNext: "goblin_defeat"
      - key: "run"
        text: "Run back into the trees"
        next: "forest"
      - key: "band"
        text: "Continue to the bandit stretch"
        next: "road_three"
      - key: "horde"
        text: "Dare the horde further on"
        next: "road_horde"

  road_three:
    text: "Two foes block the path: a goblin and an orc. Choose who to attack."
    scenery: "road"
    choices:
      - key: "battle"
        text: "Fight"
        next: "forest"
        battle:
          enemies:
            - name: "Goblin"
              strength: 8
              health: 3
            - name: "Orc"
              strength: 10
              health: 5
          onVictoryNext: "band_victory"
          onDefeatNext: "goblin_defeat"

  road_horde:
    text: "A pack of creatures swarms the road. You face a horde."
    scenery: "road"
    choices:
      - key: "battle"
        text: "Fight"
        next: "forest"
        battle:
          enemies:
            - name: "Goblin"
              strength: 6
              health: 2
            - name: "Goblin"
              strength: 6
              health: 2
            - name: "Orc"
              strength: 9
              health: 4
            - name: "Wolf"
              strength: 7
              health: 3
          onVictoryNext: "horde_victory"
          onDefeatNext: "goblin_defeat"

  band_victory:
    text: "You cut down the band. The road is clear."
    scenery: "road"
    effects:
      - op: "add"
        stat: "luck"
        value: 1
    ending: true

  horde_victory:
    text: "The horde breaks. You stand victorious."
    scenery: "road"
    ending: true

  goblin_victory:
    text: "You cut the goblin down. The road is clear, and you feel a little luckier."
    scenery: "road"
    effects:
      - op: "add"
        stat: "luck"
        value: 1
    ending: true

  goblin_defeat:
    text: "Blows rain down until the world fades. You stagger away, badly hurt."
    scenery: "road"
    effects:
      - op: "add"
        stat: "health"
        value: -3
    ending: true

  death:
    text: "Your wounds are too great. Darkness closes in and your adventure ends here."
    scenery: "forest"
    ending: true
