{{define "game.html"}}
  <div class="stats-update" data-strength="{{.State.Stats.Strength}}" data-luck="{{.State.Stats.Luck}}" data-health="{{.State.Stats.Health}}" style="display: none;"></div>
  {{if .LastPlayerDice}}
  <div class="player-dice-update" data-dice1="{{index .LastPlayerDice 0}}" data-dice2="{{index .LastPlayerDice 1}}" style="display: none;"></div>
  {{end}}
  {{if .LastEnemyDice}}
  <div class="enemy-dice-update" data-dice1="{{index .LastEnemyDice 0}}" data-dice2="{{index .LastEnemyDice 1}}" style="display: none;"></div>
  {{end}}
  {{range .Enemies}}
  <div class="enemy-update" data-enemy-name="{{.Name}}" data-enemy-strength="{{.Strength}}" data-enemy-health="{{.Health}}" style="display: none;"></div>
  {{else}}
  <div class="enemy-update" data-enemy-name="" data-enemy-strength="0" data-enemy-health="0" style="display: none;"></div>
  {{end}}

  <div class="story-area story-area-game" {{if .Node.Audio}}data-audio-url="/audio/{{.State.StoryID}}/{{.Node.Audio}}"{{end}}>
    <div class="scenery {{if .Node.Scenery}}scenery-{{.Node.Scenery}}{{else}}scenery-default{{end}} {{if .Node.EntryAnimation}}entry-animation-{{.Node.EntryAnimation}}{{end}}" data-scenery="{{if .Node.Scenery}}{{.Node.Scenery}}{{else}}default{{end}}" role="img" aria-label="Scenery: {{if .Node.Scenery}}{{.Node.Scenery}}{{else}}default{{end}}">
      <img src="/scenery/{{.State.StoryID}}/{{if .Node.Scenery}}{{.Node.Scenery}}{{else}}default{{end}}?v=2" alt="" class="scenery-img" onerror="this.remove()">
    </div>
    <div class="story-text-strip">
      {{if .Message}}<p class="msg">{{.Message}}</p>{{end}}
      {{if .LastRoll}}
        <p class="roll">Roll: <strong>{{.LastRoll}}</strong> {{if .LastOutcome}}({{.LastOutcome}}){{end}}</p>
      {{end}}
      <p class="text">{{.Node.Text}}</p>
      {{if .Node.Ending}}
        <p class="end">— The End —</p>
      {{end}}
    </div>
  </div>

  {{if .Node.Ending}}
    <div class="choices-area">
      <button class="btn"
        onclick="window.location.href='/start'">
        Restart
      </button>
    </div>
  {{else}}
    <div class="choices-area">
      <ul class="choices">
        {{if .EffectiveChoices}}
        {{range .EffectiveChoices}}
          <li>
            <button class="btn"
              hx-post="/play"
              hx-target="#game"
              hx-swap="innerHTML"
              hx-vals='{"choice":"{{.Key}}","session_id":"{{$.SessionID}}"}'>
              {{.Text}}
            </button>
          </li>
        {{end}}
        {{else}}
        {{range .Node.Choices}}
          {{if .Prompt}}
          <li class="choice-prompt">
            <form class="prompt-form"
              hx-post="/play"
              hx-target="#game"
              hx-swap="innerHTML">
              <input type="hidden" name="session_id" value="{{$.SessionID}}">
              <div class="prompt-question">{{.Prompt.Question}}</div>
              <input type="hidden" name="choice" value="{{.Key}}">
              <input class="prompt-input" type="text" name="answer" autocomplete="off" spellcheck="false"
                placeholder="{{if .Prompt.Placeholder}}{{.Prompt.Placeholder}}{{else}}Your answer{{end}}">
              <button class="btn" type="submit">{{if .Text}}{{.Text}}{{else}}Answer{{end}}</button>
            </form>
          </li>
          {{else}}
          <li>
            <button class="btn"
              hx-post="/play"
              hx-target="#game"
              hx-swap="innerHTML"
              hx-vals='{"choice":"{{.Key}}","session_id":"{{$.SessionID}}"}'>
              {{.Text}}
            </button>
          </li>
          {{end}}
        {{end}}
        {{end}}
      </ul>
    </div>
  {{end}}
{{end}}
